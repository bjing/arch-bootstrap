---
 - name: check if stack is set up
   stat: path=/home/{{ my_username }}/.stack/global-project/stack.yaml
   register: stack
   tags: xmonad

 - name: setup stack
   become: yes
   become_user: "{{ my_username }}"
   shell: stack setup
   when: not stack.stat.exists
   tags: xmonad
 
 - name: add extra stack dependencies
   blockinfile:
     dest: /home/{{ my_username }}/.stack/global-project/stack.yaml
     marker: "# STACK EXTRA DEPENDENCIES ANSIBLE MANAGED BLOCK\n"
     block: |
       extra-deps:
         - alsa-mixer-0.2.0.3
         - parsec-numbers-0.1.0
   when: stack.stat.exists
   tags: xmonad

 - name: check if happy exists
   stat: path=/home/{{ my_username }}/.local/bin/happy
   register: happy
   tags: xmonad

 - name: install happy
   become: yes
   become_user: "{{ my_username }}"
   shell: stack install happy
   when: not happy.stat.exists
   tags: xmonad

 - name: check if alex exists
   stat: path=/home/{{ my_username }}/.local/bin/alex
   register: alex
   tags: xmonad

 - name: install alex
   become: yes
   become_user: "{{ my_username }}"
   shell: stack install alex
   when: not alex.stat.exists
   tags: xmonad

 - name: check if c2hs exists
   stat: path=/home/{{ my_username }}/.local/bin/c2hs
   register: c2hs
   tags: xmonad

 - name: install c2hs
   become: yes
   become_user: "{{ my_username }}"
   shell: stack install c2hs
   when: not c2hs.stat.exists
   tags: xmonad

 - name: check if xmobar exists
   stat: path=/home/{{ my_username }}/.local/bin/xmobar
   register: xmobar
   tags: xmonad

 - name: install xmobar
   become: yes
   become_user: "{{ my_username }}"
   shell: stack install xmobar --flag xmobar:with_dbus --flag xmobar:with_alsa --flag xmobar:with_xft --flag xmobar:with_datezone 
   when: not xmobar.stat.exists
   tags: xmonad

 - name: check if xmonad exists
   stat: path=/home/{{ my_username }}/.local/bin/xmonad
   register: xmonad
   tags: xmonad

 - name: install xmonad
   become: yes
   become_user: "{{ my_username }}"
   shell: stack install xmonad xmonad-contrib
   when: not xmonad.stat.exists
   tags: xmonad

