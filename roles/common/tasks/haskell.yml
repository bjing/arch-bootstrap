---
- name: retrieve gpg key for ncurses5-compat-libs
  become: yes
  become_user: "{{ bootstrap_username }}"
  command: gpg --recv-keys C52048C0C0748FEE227D47A2702353E0F7E48EDB
  tags: haskell

- name: retrieve gpg key for stack-static
  become: yes
  become_user: "{{ bootstrap_username }}"
  command: gpg --recv-keys C5705533DA4F78D8664B5DC0575159689BEFB442
  tags: haskell

- name: install stack-static
  become: yes
  environment:
    SUDO_USER: "{{ bootstrap_username }}"
  makepkg:
    name: "{{ item }}"
    state: present
    build_dir: /tmp
  with_items:
    - ncurses5-compat-libs
    - stack-static
  tags: haskell

- name: create nightly-2017-06-28 snapshot directory
  file:
    path: "/home/{{ my_username }}/.stack/snapshots/x86_64-linux-tinfo6"
    state: directory
    owner: "{{ my_username }}"
    group: "{{ my_username }}"
  tags: haskell

- name: download nightly-2017-06-28 snapshot
  become: yes
  become_user: "{{ my_username }}"
  unarchive:
    src: "https://www.dropbox.com/s/yu4pc2o3sjq1nx0/nightly-2017-06-28.tar.gz?dl=1"
    dest: "/home/{{ my_username }}/.stack/snapshots/x86_64-linux-tinfo6"
    owner: "{{ my_username }}"
    group: "{{ my_username }}"
    remote_src: yes
  tags: haskell

- name: install ghc 8.0.2
  become: yes
  become_user: "{{ my_username }}"
  command: "stack setup --resolver nightly-2017-06-28"
  tags: haskell

- name: install ghc-mod 5.8.0.0
  become: yes
  become_user: "{{ my_username }}"
  command: "stack install ghc-mod --resolver nightly-2017-06-28"
  tags: haskell

